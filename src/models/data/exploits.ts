/**
 * Exploit data extracted from Bitburner source (.bitburner-src-dev/src/Exploits/Exploit.ts)
 *
 * Exploits grant "Source-File -1" bonuses - a 1.001^count multiplier per exploit.
 * Discovering exploits is meant to be a learning experience in the spirit of the game.
 */

/**
 * All exploit types
 */
export const Exploit = {
  Bypass: 'Bypass',
  PrototypeTampering: 'PrototypeTampering',
  Unclickable: 'Unclickable',
  UndocumentedFunctionCall: 'UndocumentedFunctionCall',
  TimeCompression: 'TimeCompression',
  RealityAlteration: 'RealityAlteration',
  N00dles: 'N00dles',
  YoureNotMeantToAccessThis: 'YoureNotMeantToAccessThis',
  TrueRecursion: 'TrueRecursion',
  INeedARainbow: 'INeedARainbow',
  EditSaveFile: 'EditSaveFile',
} as const;

export type ExploitType = typeof Exploit[keyof typeof Exploit];

/**
 * All exploit values as an array
 */
export const ALL_EXPLOITS = Object.values(Exploit);

/**
 * Human-readable descriptions for how each exploit is obtained
 */
export const EXPLOIT_DESCRIPTIONS: Record<ExploitType, string> = {
  [Exploit.Bypass]: 'Circumventing the RAM cost of document.',
  [Exploit.EditSaveFile]: 'Editing your save file.',
  [Exploit.PrototypeTampering]: 'Tampering with Numbers prototype.',
  [Exploit.TimeCompression]: 'Compressing time.',
  [Exploit.Unclickable]: 'Clicking the unclickable.',
  [Exploit.UndocumentedFunctionCall]: 'Looking beyond the documentation.',
  [Exploit.RealityAlteration]: 'Altering reality to suit your whims.',
  [Exploit.N00dles]: 'Harnessing the power of the n00dles.',
  [Exploit.YoureNotMeantToAccessThis]: 'Accessing the dev menu.',
  [Exploit.TrueRecursion]: 'Truly recursing.',
  [Exploit.INeedARainbow]: 'Using the power of the rainbow.',
};

/**
 * Extended metadata for each exploit (for UI display)
 * Hints are based on actual game mechanics from Bitburner source code
 */
export interface ExploitMetadata {
  name: ExploitType;
  description: string;
  hint: string;
  difficulty: 'Easy' | 'Medium' | 'Hard' | 'Secret';
}

export const EXPLOIT_METADATA: Record<ExploitType, ExploitMetadata> = {
  [Exploit.EditSaveFile]: {
    name: Exploit.EditSaveFile,
    description: 'Editing your save file.',
    hint: 'You\'re using a save editor right now! Add this exploit to your save.',
    difficulty: 'Easy',
  },
  [Exploit.Bypass]: {
    name: Exploit.Bypass,
    description: 'Circumventing the RAM cost of document.',
    hint: 'Call ns.bypass(document) with the real document object while your script uses only base RAM (1.6GB).',
    difficulty: 'Hard',
  },
  [Exploit.PrototypeTampering]: {
    name: Exploit.PrototypeTampering,
    description: 'Tampering with Numbers prototype.',
    hint: 'Override Number.prototype.toExponential() so that (55).toExponential() !== "5.5e+1". Checked every 15 minutes.',
    difficulty: 'Medium',
  },
  [Exploit.Unclickable]: {
    name: Exploit.Unclickable,
    description: 'Clicking the unclickable.',
    hint: 'There\'s a hidden <div id="unclickable"> with display:none and visibility:hidden. Use browser DevTools to click it.',
    difficulty: 'Medium',
  },
  [Exploit.UndocumentedFunctionCall]: {
    name: Exploit.UndocumentedFunctionCall,
    description: 'Looking beyond the documentation.',
    hint: 'Call ns.exploit() - it\'s not in the docs but it exists!',
    difficulty: 'Easy',
  },
  [Exploit.TimeCompression]: {
    name: Exploit.TimeCompression,
    description: 'Compressing time.',
    hint: 'Make 15 seconds of real time pass in less than 0.5 seconds. Hint: performance.now() can be manipulated.',
    difficulty: 'Hard',
  },
  [Exploit.RealityAlteration]: {
    name: Exploit.RealityAlteration,
    description: 'Altering reality to suit your whims.',
    hint: 'Call ns.alterReality() - but the code path that grants the exploit is "impossible" to reach. Can you change reality?',
    difficulty: 'Hard',
  },
  [Exploit.N00dles]: {
    name: Exploit.N00dles,
    description: 'Harnessing the power of the n00dles.',
    hint: 'Visit the Noodle Bar in New Tokyo and eat noodles after you\'ve destroyed at least one BitNode.',
    difficulty: 'Medium',
  },
  [Exploit.YoureNotMeantToAccessThis]: {
    name: Exploit.YoureNotMeantToAccessThis,
    description: 'Accessing the dev menu.',
    hint: 'Open the developer menu with ns.openDevMenu() or find another way in.',
    difficulty: 'Easy',
  },
  [Exploit.TrueRecursion]: {
    name: Exploit.TrueRecursion,
    description: 'Truly recursing.',
    hint: 'Visit the Arcade location and complete the embedded game. It communicates your victory back to Bitburner.',
    difficulty: 'Medium',
  },
  [Exploit.INeedARainbow]: {
    name: Exploit.INeedARainbow,
    description: 'Using the power of the rainbow.',
    hint: 'Call ns.rainbow(password) with the correct password. The hash is bcrypt - can you crack it?',
    difficulty: 'Secret',
  },
};

/**
 * Get exploit metadata by name
 */
export function getExploitMetadata(name: string): ExploitMetadata | undefined {
  return EXPLOIT_METADATA[name as ExploitType];
}

/**
 * Check if a string is a valid exploit name
 */
export function isValidExploit(name: string): name is ExploitType {
  return ALL_EXPLOITS.includes(name as ExploitType);
}

/**
 * Calculate the multiplier bonus from exploits
 * Exploits give 1.001^count bonus (or 0.999^count for cost fields)
 */
export function calculateExploitMultiplier(exploitCount: number, isCostField: boolean = false): number {
  if (exploitCount <= 0) return 1;
  const mult = 1.001;
  return isCostField ? Math.pow(1 / mult, exploitCount) : Math.pow(mult, exploitCount);
}
